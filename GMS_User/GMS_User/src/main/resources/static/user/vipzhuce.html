<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>会员注册</title>
    <link rel="stylesheet" href="../css/toast.css">
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/SMS-index.css" />
    <link rel="stylesheet" href="../css/swiper.min.css">
    <link rel="stylesheet" href="../css/button.css">
    <link rel="stylesheet" href="../css/showMessage.css">
    <link rel="stylesheet" href="../css/animate.css">
    <title>注册页面</title>
    <style>
        body {
            background: url("./img/play01.jpg");
        }

        .rg_form{
            text-align:center;
        }
        .rg_layout {
            width: 1500px;
            height: 900px;
            border: 8px solid #EEEEEE;
            background-color: white;
            margin: auto;
        }

        .rg_left {
            float: left;
            margin: 15px;
        }
        .rg_center {
            float:left;
        }
        .rg_right {
            float: right;
            margin: 15px;
        }

        .rg_left > p:first-child {
            color:dodgerblue;
            font-size: 20px;
        }

        .rg_left > p:last-child {
            color:dodgerblue;
            font-size: 20px;
        }

        .rg_right > p:first-child {
            font-size: 15px;

        }
        .rg_right p a {
            color:pink;
        }

        .td_left {
            width: 100px;
            height: 45px;
            text-align: right;
        }
        .td_right {
            padding-left: 50px ;
        }

        #username, #password, #email, #name, #tel, #birthday, #checkcode {
            width: 251px;
            height: 32px;
            border: 1px solid #A6A6A6;
            border-radius: 5px;
            padding-left: 10px;
        }

        #checkcode {
            width: 110px;
        }

        #img_check {
            height: 32px;
            vertical-align: middle;
        }

        #btn_sub {
            width: 150px;
            height: 40px;
            font-weight:bold;
            background-color: lightsteelblue;
            border: 1px solid lightsteelblue ;
        }
        .greenbr {
            text-align: center;
            border: solid;
            border-radius: 8px;
            border-width: 40px 30px;
            border-color: #ffffff;
            color: #000000;
        }

        .panal {
            width: 50%;
            margin: 0 auto;
            margin-bottom: 30px;
        }
        .error {
            color:red;
        }
        #td_sub {
            padding-left: 150px;
        }
        .code
        {
            font-family:Arial;
            font-style:italic;
            color:blue;
            font-size:30px;
            border:0;
            padding:2px 3px;
            letter-spacing:3px;
            font-weight:bolder;
            float:right;
            cursor:pointer;
            width:150px;
            height:50px;
            line-height:60px;
            text-align:center;
            vertical-align:middle;
            background-color:#D8B7E3;
        }
        span {
            text-decoration:none;
            font-size:12px;
            color:#288bc4;
            padding-left:10px;
        }

        span:hover {
            text-decoration:underline;
            cursor:pointer;
        }
    </style>
    <script>
        window.onload = function(){
            document.getElementById("form").onsubmit = function(){
                return checkUsername() && checkPassword();
            };
            document.getElementById("username").onblur = checkUsername;
            document.getElementById("password").onblur = checkPassword;
        };

        function checkUsername(){
            var username = document.getElementById("username").value;
            var reg_username = /^\w{6,12}$/;
            var flag = reg_username.test(username);
            var s_username = document.getElementById("s_username");
            if(flag){
                s_username.innerHTML = "<img width='35' height='25' src='img/gou.png'/>";
            }else{
                s_username.innerHTML = "用户名格式有误";
            }
            return flag;
        }

        function checkPassword(){
            var password = document.getElementById("password").value;
            var reg_password = /^\w{6,12}$/;
            var flag = reg_password.test(password);
            var s_password = document.getElementById("s_password");
            if(flag){
                s_password.innerHTML = "<img width='35' height='25' src='img/gou.png'/>";
            }else{
                s_password.innerHTML = "密码格式有误";
            }
            return flag;
        }

    </script>
</head>
<body>

<div id="app">
    <!--引入头部-->
    <div class="header">
        <div class="real_header">
            <a href="#" style="text-decoration: none; color: #337ab7;"> <img src="../img/logo.png" class="head_img"> <span class="head_span1">体育馆场地管理系统</span>
            </a>
            <div class="login">
                <div>
                    <input type="hidden" v-model="user_Id"  id="user_Id" name="user_Id" readonly >
                </div>
                <div >
                    <a v-if="user_Id ==''" v-on:click="toLogin" style="margin-left: -60px;">登录</a>
                    <a v-else style="margin-left: -60px;" ></a>
                </div>
                <div class="dropdown" style="margin-top: -22px;">
                    <a v-if="user_Id ==''" class="dropdown-toggle" data-toggle="dropdown"
                       role="button" aria-haspopup="true" aria-expanded="false"> <i
                            class="glyphicon glyphicon-user"></i> 个人中心
                    </a>
                    <a id="session_user" v-else class="dropdown-toggle" data-toggle="dropdown"
                       role="button" aria-haspopup="true" aria-expanded="false"> <i
                            class="glyphicon glyphicon-user"></i> {{user_Id}}
                    </a>
                    <ul class="dropdown-menu " aria-labelledby="dropdownMenu1">
                        <li>
                            <a v-on:click="toCenter" data-toggle="modal" >
                                <i class="glyphicon glyphicon-user"></i>
                                个人中心
                            </a>
                        </li>
                        <li role="separator" class="divider"></li>
                        <li>
                            <a v-on:click="loginOut" >
                                <i class="glyphicon glyphicon-off"></i>
                                注销登录
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

        </div>

    </div>
</div>

<div class="top-bar">
    <div class="box-top">
        <ul class="top-ui">
            <li>
                <a href="#"><img src="../img/send.png"></a>
            </li>
            <li>
                <a href="/user/index">首页</a>
            </li>
            <li>
                <a id="checkmem" href="javascript:void(0)" onclick="checkmem()">场地预约</a>
            </li>
            <li>
                <a href="/user/vip.html">会员管理</a>
            </li>
            <li>
                <a href="/user/announcement.html">系统通知</a>
            </li>
        </ul>
    </div>
</div>

<style>
    /*兼容浏览器*/
    * {
        margin: 0;
        padding: 0;
    }

    p {

        padding:10px
    }
    .plable
    {
        font-weight:bold;
    }
    .plable1
    {
        font-weight:bold;
        color:steelblue;
    }
    .content {
        width: 100%;
        height: 600px;
    }

    .content-left {
        width: 19%;
        height: 600px;
        background-color: lightsteelblue;
        float: left;
    }

    .content-right {
        width: 81%;
        height: 600px;
        background-color: honeydew;
        float: left;
    }

    .left-title {
        width: 100%;
        height: 50px;
    }

    .left-title > a {
        display: block;
        width: 100%;
        height: 50px;
        line-height: 50px;
        text-align: center;
        color: white;
        /*去掉a下默认下划线*/
        text-decoration: none;
    }

    /*分割线*/
    .seg {
        height: 1px;
        width: 100%;
        background-color: black;
    }

    .nav {
        /*上下5,左右0*/
        margin: 5px 0;
    }

    /*菜单项主标题*/
    .nav-title {
        height: 40px;
        width: 100%;
        color: black;
        text-align: center;
        line-height: 40px;
        cursor: pointer;
    }

    /*子标题内容区*/
    .nav-content {
        width: 100%;
        height: 100%;
        background-color: powderblue;
    }

    /*子标题的样式*/
    .nav-content > a {
        display: block;
        width: 100%;
        height: 30px;
        color: black;
        text-decoration: none;
        text-align: center;
        line-height: 30px;
        font-size: 13px;
    }

    /*子标题鼠标经过时的改变颜色*/
    .nav-content > a:hover {
        color: black;
        background-color: steelblue;
    }

    /*内容区*/
    .content-right{
        font-size: 15px;
        line-height: 8px;
        text-align: center;
    }

</style>

<div class = "content">
    <!--左侧导航栏-->
    <div class = "content-left">
        <div class = "left-title">
            <a href = "/user/vip.html">会员管理</a>
        </div>

        <!--水平线-->
        <div class = "seg"></div>

        <!--菜单栏导航-->
        <div class = "nav">
            <!--每一个菜单栏项-->
            <div class = "nav-menu">
                <div class = "nav-content">
                    <a id="vipzhuce" href="javascript:void(0)" onclick="checkmem1()" >会员注册</a>
                    <a id="member-pay" href="javascript:void(0)" onclick="checkmem2()">会员充值</a>
                </div>
            </div>
        </div>
        <!--水平线-->
        <div class = "seg"></div>
    </div>
    <div class="content-right"  >
        <div class="sign-up-from">
            <div id="register_app">
                <form class="register-form">
                    <h1 class="plable1">会员注册</h1>
                    <p class="plable">学号：
                    <input type="text" class="input-box" id="vip_Userid"  v-model="vip_Userid" name="vip_Userid" placeholder="学号/工号" readonly required="true"/>
                    </p>

                    <p class="plable">身份证号：
                    <input type="text" class="input-box" id="vip_Id" v-model="vip_Id" name="vip_Id" placeholder="身份证号" readonly required="true"/>
                    </p>
<!--                    <p class="plable">密码：-->
<!--                    <input type="password" class="input-box" id="vip_Password" v-model="vip_Password" name="vip_Password" placeholder="密码" required="true"/>-->
<!--                    </p>-->
                    <p class="plable">手机号码
                    <input type="text" class="input-box" id="vip_Phone" name="vip_Phone" v-model="vip_Phone" placeholder="手机号码" readonly required="true" >
                    </p>
                    <p class="plable">电子邮箱：
                    <input type="email" class="input-box" id="vip_Email"  v-model="vip_Email" name="vip_Email" placeholder="电子邮件" readonly required="true" />
                    </p>
                    <p class="plable">姓名：
                    <input type="text" class="input-box" id="vip_Name"  v-model="vip_Name" name="vip_Name"  readonly required="true" />
                    </p>
                    <p class="plable">性别：
                        <input type="text" class="input-box" id="vip_Gender"  v-model="vip_Gender" name="vip_Gender" readonly required="true" />
                    </p>

<!--                    <p id="vip_Account"  class="plable">充值金额：-->
<!--                    <input type="radio" v-model="vip_Account" name="vip_Account" value="500" onclick="get(0)" > 500-->
<!--                    <input type="radio" v-model="vip_Account" name="vip_Account" value="1000" onclick="get(1)"> 1000-->
<!--                    </p>-->
<!--                    <label for="vip_Account" class="col-xs-3 control-label">金额</label>-->
<!--                    <div class="col-xs-9">-->
<!--                        <input type="text" class="form-control" id="vip_Account" name="vip_Account" v-model="vip_Account" readonly value="0">-->
<!--                    </div>-->
                    <p class="plable">充值金额：
                        <input type="text" class="input-box" id="vip_Account"  v-model="vip_Account" name="vip_Account"  readonly required="true" />
                    </p>
                    <p>

                    </p>
                    <div class="panal">
                    <div class="row">
                        <div class="col-xs-5 greenbr" onclick="get(0)" style="background-color:#ffffff;color:#000000">
                            <strong>500元</strong>
                        </div>
                        <div class="col-xs-offset-2 col-xs-5 greenbr" onclick="get(1)" style="background-color:#ffffff;color:#000000">
                            <strong>1000元</strong>
                        </div>
                    </div>
                    </div>
                    <button type="button" id="btn_sub" class="sign-up-btn" v-on:click="register">注册</button>
                </form>
            </div>
        </div>




    </div>
</div>

<!--尾巴-->
<div class="container-fluid f_top">
    <div class="row">
        <div class="footer" style="position: fixed;">
            版权所有@有请下一组 &nbsp;&nbsp;</div>
    </div>
</div>

</body>

<script src="../js/jquery-3.4.1.min.js"></script>
<script src="../js/bootstrap.min.js"></script>
<script src="../js/swiper.min.js"></script>
<script src="../js/toast.js"></script>
<script src="../js/vue.js"></script>
<script src="../js/captcha-generate.js"></script>
<script>

    let app = new Vue({
        el: '#app',
        data: {
            user_Id:""
        },
        mounted:function(){
            this.getSession();//页面加载函数
            this.getSchool();
        },
        methods: {
            getSession: function(){
                $.get("/user/getSession",function (data) {
                    app.user_Id = data.user_Id
                    document.getElementById("vip_Email").value=data.user_Email;
                    document.getElementById("vip_Phone").value=data.user_Id;
                },"json");
            },
            getSchool:function(){
                $.get("/user/getSchool",function (data) {
                    app.idcard = data.inschool_idcard
                    document.getElementById("vip_Id").value=data.inschool_idcard;
                    document.getElementById("vip_Userid").value=data.inschool_Id;
                    document.getElementById("vip_Name").value=data.inschool_Name;
                    document.getElementById("vip_Gender").value=data.inschool_Sex;
                },"json");
            },
            loginOut: function () {
                $.post("/user/logout",function (data) {
                    window.location.href="/user/index";
                },"json");
            },
            toCenter: function () {
                window.location.href="/user/center";
            },
            toLogin:function () {
                window.location.href="/user/login";
            }
        }
    });

    function getByClass(parent, cls) {
        if (parent.getElementsByClassName) {
            return parent.getElementsByClassName(cls);
        } else {
            var res = [];
            var reg = new RegExp(' ' + cls + ' ', 'i')
            var ele = parent.getElementsByTagName('*');
            for (var i = 0; i < ele.length; i++) {
                if (reg.test(' ' + ele[i].className + ' ')) {
                    res.push(ele[i]);
                }
            }
            return res;
        }
    }

    function get(index) {
        var choose = getByClass(document, 'greenbr');
        for (let i = 0; i < choose.length; i++) {
            choose[i].style.backgroundColor = "#fff";
            choose[i].style.color = "#000000";
        }
        choose[index].style.backgroundColor = "#fff";
        choose[index].style.color = "#87ceeb";

        var vip_Account = document.getElementById("vip_Account");
        if(index == 0) { money = 500; } else
        if(index == 1) { money = 1000; }
        vip_Account.value = money;
    }

    let flag = true;
    let isEmail = true;
    let isUserid=true;
    let isPass=true;
    let isId=true;
    let isPhone=true;
    let isAccount=true;
    // 同一个页面跳转
    $(function () {
        $('.message a').click(function () {
            $('form').animate({
                height: 'toggle',
                opacity: 'toggle'
            }, 'slow');
        });

        //验证邮箱格式是否正确
        $('#vip_Email').blur(function(){
            var vip_Email =$('#vip_Email').val();
            if(!vip_Email.match(/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/)){
                showMessage('邮箱格式不正确',2000,true,'bounceIn-hastrans','bounceOut-hastrans');
                isEmail = false
            }else{
                isEmail = true
            }
        });



        //限制学号
        $('#vip_Userid').blur(function(){
            var vip_Userid=$('#vip_Userid').val();
            if(!vip_Userid.match(/^\d{8}$/))
            {
                showMessage('学号不正确',2000,true,'bounceIn-hastrans','bounceOut-hastrans');
                isUserid=false;
            }
            else{
                isUserid=true;
            }
        });

        //限制密码
        $('#vip_Password').blur(function(){
            var vip_Password=$('#vip_Password').val();
            if(!vip_Password.match( /^[a-zA-Z0-9]{6,15}$/))
            {
                showMessage('密码格式不正确，请输入6到15位数字或字母',2000,true,'bounceIn-hastrans','bounceOut-hastrans');
                isPass=false;
            }
            else{
                isPass=true;
            }
        });

        //身份证号
        $('#vip_Id').blur(function(){
            var vip_Id=$('#vip_Id').val();
            if(!vip_Id.match(/^\d{18}$/))
            {
                showMessage('身份证号格式不正确',2000,true,'bounceIn-hastrans','bounceOut-hastrans');
                isId=false;
            }
            else{
                isId=true;
            }
        });

        $('#vip_Phone').blur(function(){
            var vip_Phone=$('#vip_Phone').val();

            if(!vip_Phone.match(/^1[3456789]\d{9}$/))
            {
                showMessage('请输入正确的手机号',2000,true,'bounceIn-hastrans','bounceOut-hastrans');
                isPhone=false;
            }
            else{
                isPhone=true;
            }
        });


        //后台校验用户是否存在(通过检查身份证号)
        $('#vip_Id').blur(function(){
            var vip_Id =$('#vip_Id').val();
            $.ajax({
                "url":"/user/checkVipname",
                "data":{"vip_Id":vip_Id},
                "type":"get",
                "dataType":"json",
                "success":function(data){
                    if(data.info != null){
                        flag = false;
                        showMessage('您已是会员,请勿重复注册',2000,true,'bounceIn-hastrans','bounceOut-hastrans');
                    }else{
                        flag = true;
                    }
                }
            });
        });
    })

    let registervip = new Vue({
        el: "#register_app",
        data: {
            vip_Userid:"",   //用户名，学号
            vip_Gender: "",
            vip_Id:"",
            vip_Password:"",
            vip_Phone:"",
            vip_Email:"",
            vip_Name:"",
            vip_Account:""
        },
        methods: {
            register:function(){
                if($('#vip_Account').val()!=500&&$('#vip_Account').val()!=1000)
                {
                    showMessage('请选择充值金额',2000,true,'bounceIn-hastrans','bounceOut-hastrans');
                    isAccount = false
                }else{
                    isAccount = true
                }
                if(!flag){
                    showMessage('用户id已被占用，请重新取名',2000,true,'bounceIn-hastrans','bounceOut-hastrans');
                }else if(!isEmail){
                    showMessage('邮件格式错误',2000,true,'bounceIn-hastrans','bounceOut-hastrans');
                }else if(!isUserid){
                    showMessage('用户名格式错误',2000,true,'bounceIn-hastrans','bounceOut-hastrans');
                }else if(!isPass){
                    showMessage('密码格式错误',2000,true,'bounceIn-hastrans','bounceOut-hastrans');
                }else if(!isId){
                    showMessage('身份证号格式错误',2000,true,'bounceIn-hastrans','bounceOut-hastrans');
                }else if(!isPhone){
                    showMessage('手机号格式错误',2000,true,'bounceIn-hastrans','bounceOut-hastrans');
                }else if(!isAccount){
                    showMessage('请选择充值金额',2000,true,'bounceIn-hastrans','bounceOut-hastrans');
                }else{
                    $.ajax({
                        type: "POST",
                        url: "/user/register_vip",
                        dataType: "json",
                        data: JSON.stringify({vip_Name:$('#vip_Name').val(),vip_Phone:$('#vip_Phone').val(),vip_Id:$('#vip_Id').val(),vip_Email:$('#vip_Email').val(),vip_Account:$('#vip_Account').val(),vip_Gender:$('#vip_Gender').val(),vip_Userid:$('#vip_Userid').val()}),
                        contentType: "application/json",
                        success: function (data) {
                            if(data.state == "1"){
                                showMessage('恭喜你注册成功！',3000,true,'bounceIn-hastrans','bounceOut-hastrans')
                                setTimeout("window.location.href='/user/index'", 3000);
                            }else if(data.state == "0"){
                                showMessage('注册失败，请重试！',3000,true,'bounceIn-hastrans','bounceOut-hastrans')
                            }
                        }
                    });
                }
            }
        },

    });

    function checkmem1(){

            $.ajax({
                    type: 'GET',
                    url: "/user/checkmember",
                    dataType: "json",
                    data: "user_Id="+$('#user_Id').val(),
                    contentType : "application/json;charset=utf-8",
                    success: function(data) {
                        if (data.info != null) {
                            alert('您已经是会员，请勿重复注册！');
                        } else {
                            window.location.href = "/user/vipzhuce.html";
                        }
                    }
                }
            );
    }

    function checkmem2(){

        $.ajax({
                type: 'GET',
                url: "/user/checkmember",
                dataType: "json",
                data: "user_Id="+$('#user_Id').val(),
                contentType : "application/json;charset=utf-8",
                success: function(data) {
                    if (data.info == null) {
                        alert('您还不是会员，请先注册！');
                        window.location.href = "/user/vipzhuce.html";
                    } else {
                        window.location.href = "/user/member-pay.html";
                    }
                }
            }
        );
    }

    function checkmem(){
        if($('#session_user').text() == ""){
            showMessage('请登录后再预约',2000,true,'bounceIn-hastrans','bounceOut-hastrans');
            setTimeout("window.location.href='login.html'", 1500);
        }else{
            //
            $.ajax({
                    type: 'GET',
                    url: "/user/checkmember",
                    dataType: "json",
                    data: "user_Id="+$('#user_Id').val(),
                    contentType : "application/json;charset=utf-8",
                    success: function(data) {
                        if(data.info!=null)
                        {
                            if(data.info.vip_Id!=null){
                                window.location.href="/user/yuyue1.html";}
                            else
                            {
                                var r=confirm('查询到您有多张会员卡，请前往前台办理。点击取消可继续预约，但会失去会员优惠！');
                                if (r==false){
                                    window.location.href="/user/yuyue.html";
                                }
                            }

                        }
                        else
                        {
                            window.location.href="/user/yuyue.html";
                        }

                    }

                }
            );
        }
    }
</script>

</html>